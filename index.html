<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimexBaku | Cloud Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --neon: #bf00ff; --deep: #05010a; --glass: rgba(255, 255, 255, 0.05); --white: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--deep); color: var(--white); font-family: 'Poppins', sans-serif; }
        .page { display: none; padding: 100px 20px; animation: fadeIn 0.5s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        header { position: fixed; top: 0; width: 100%; z-index: 1000; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--neon); }
        .logo { font-family: 'Orbitron'; font-size: 24px; color: var(--neon); cursor: pointer; text-shadow: 0 0 10px var(--neon); }
        
        .search-container { flex: 1; margin: 0 50px; }
        .search-container input { width: 100%; padding: 10px 20px; border-radius: 20px; background: var(--glass); border: 1px solid var(--neon); color: white; }
        
        .card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; max-width: 500px; margin: auto; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: rgba(0,0,0,0.5); border: 1px solid var(--neon); color: white; border-radius: 10px; }
        
        .btn { background: var(--neon); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        .btn:hover { box-shadow: 0 0 15px var(--neon); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; }
        .p-card { background: var(--glass); border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .p-img { width: 100%; height: 200px; object-fit: cover; background: #111; }
        .vip-tag { position: absolute; top: 10px; right: 10px; background: gold; color: black; padding: 2px 8px; border-radius: 5px; font-weight: bold; font-size: 12px; box-shadow: 0 0 10px gold; }
        
        #adminPanel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; display: none; padding: 50px; overflow-y: auto; }
        .admin-table { width: 100%; border-collapse: collapse; color: white; }
        .admin-table th, td { padding: 10px; border: 1px solid #333; }
        .signature { position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: #111; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="showPage('homePage')">TIMEXBAKU</div>
    <div class="search-container" id="searchBox" style="display:none;">
        <input type="text" id="searchInput" placeholder="Məhsul axtar..." onkeyup="searchAds()">
    </div>
    <div id="navButtons"></div>
</header>

<div id="regPage" class="page active">
    <div class="card">
        <h2 style="font-family: Orbitron; color: var(--neon);">QEYDİYYAT</h2>
        <input type="text" id="regName" placeholder="İstifadəçi adı">
        <input type="password" id="regPass" placeholder="Şifrə">
        <input type="text" id="regPhone" value="+994" maxlength="13">
        <button class="btn" onclick="register()">QEYD OL</button>
        <p style="margin-top:15px; font-size:12px">Hesabın var? <span onclick="showPage('loginPage')" style="color:var(--neon); cursor:pointer">Giriş et</span></p>
    </div>
</div>

<div id="loginPage" class="page">
    <div class="card">
        <h2 style="font-family: Orbitron; color: var(--neon);">GİRİŞ</h2>
        <input type="text" id="logName" placeholder="Ad və ya ID">
        <input type="password" id="logPass" placeholder="Şifrə">
        <button class="btn" onclick="login()">DAXİL OL</button>
    </div>
</div>

<div id="homePage" class="page">
    <h2 style="margin-bottom:20px; font-family: Orbitron;">GLOBAL MARKET</h2>
    <div class="grid" id="mainGrid"></div>
</div>

<div id="shopPage" class="page">
    <div class="card" id="setupShopCard">
        <h3>MAĞAZA QUR</h3>
        <input type="text" id="shopNameInput" placeholder="Mağaza adı">
        <button class="btn" onclick="setupShop()">AKTİVLƏŞDİR</button>
    </div>
    <div id="postAdSection" style="display:none;">
        <div class="card">
            <h3>YENİ ELAN</h3>
            <input type="text" id="pTitle" placeholder="Məhsul adı">
            <input type="number" id="pPrice" placeholder="Qiymət (AZN)">
            <input type="file" id="pFiles" accept="image/*">
            <button class="btn" onclick="createAd()">PAYLAŞ</button>
        </div>
    </div>
</div>

<div id="adminPanel">
    <h1 style="color:var(--neon)">CORE ADMIN</h1>
    <div style="margin: 20px 0;">
        <button class="btn" style="width:auto" onclick="renderAdminUsers()">İstifadəçilər</button>
        <button class="btn" style="width:auto" onclick="renderAdminAds()">Elanlar</button>
        <button class="btn" style="width:auto; background:red" onclick="closeAdmin()">BAĞLA</button>
    </div>
    <div id="adminContent"></div>
</div>

<div class="signature" onclick="adminTrigger()">ismayilismayilov</div>

<script>
    // Firebase Konfiqurasiyası
    const firebaseConfig = {
        appId: "1:437161554576:web:72281d60856c6c3851de15",
        projectId: "timexbaku", // Layihə adını bura yazmalısan
        apiKey: "AIzaSy..." // Firebase panelindən götür
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentUser = null;
    let adminClicks = 0;

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('searchBox').style.display = (id === 'homePage') ? 'block' : 'none';
        updateNav();
    }

    function updateNav() {
        const nav = document.getElementById('navButtons');
        if(currentUser) {
            nav.innerHTML = `<span style="color:var(--neon)">${currentUser.id}</span> 
                             <button class="btn" style="width:auto; padding:5px 10px" onclick="showPage('shopPage')">Mağazam</button>
                             <button class="btn" style="width:auto; padding:5px 10px; background:none" onclick="location.reload()">Çıxış</button>`;
        }
    }

    // CLOUD QEYDİYYAT
    async function register() {
        const name = document.getElementById('regName').value;
        const pass = document.getElementById('regPass').value;
        const phone = document.getElementById('regPhone').value;
        const id = "t" + Math.floor(Math.random() * 89999 + 10000);

        const check = await db.collection("users").where("name", "==", name).get();
        if(!check.empty) return alert("Bu ad artıq istifadə olunub!");

        await db.collection("users").doc(id).set({
            id, name, pass, phone, hasShop: false, status: 'Active'
        });
        alert("Qeydiyyat tamamlandı! ID: " + id);
        showPage('loginPage');
    }

    // CLOUD GİRİŞ
    async function login() {
        const name = document.getElementById('logName').value;
        const pass = document.getElementById('logPass').value;

        const res = await db.collection("users").where("name", "==", name).where("pass", "==", pass).get();
        if(res.empty) return alert("Məlumatlar səhvdir!");

        currentUser = res.docs[0].data();
        if(currentUser.status === 'Banned') return alert("Banlanmısınız!");

        showPage('homePage');
        if(currentUser.hasShop) {
            document.getElementById('setupShopCard').style.display = 'none';
            document.getElementById('postAdSection').style.display = 'block';
        }
        loadAds();
    }

    async function setupShop() {
        await db.collection("users").doc(currentUser.id).update({ hasShop: true });
        currentUser.hasShop = true;
        alert("Mağaza açıldı!");
        location.reload();
    }

    // ELAN PAYLAŞMAQ (Cloud Storage yerinə base64 istifadə edirik sadəlik üçün)
    async function createAd() {
        const title = document.getElementById('pTitle').value;
        const price = document.getElementById('pPrice').value;
        const file = document.getElementById('pFiles').files[0];

        if(!file) return alert("Şəkil seçin!");

        const reader = new FileReader();
        reader.onload = async function(e) {
            await db.collection("ads").add({
                title, price, img: e.target.result, 
                sellerId: currentUser.id, sellerPhone: currentUser.phone, 
                isVip: false, createdAt: Date.now()
            });
            alert("Paylaşıldı!");
            showPage('homePage');
            loadAds();
        }
        reader.readAsDataURL(file);
    }

    // ELANLARI YÜKLƏ
    async function loadAds() {
        const res = await db.collection("ads").orderBy("isVip", "desc").get();
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = "";
        res.forEach(doc => {
            const ad = doc.data();
            grid.innerHTML += `
                <div class="p-card">
                    ${ad.isVip ? '<div class="vip-tag">VIP</div>' : ''}
                    <img src="${ad.img}" class="p-img">
                    <div style="padding:15px">
                        <h4>${ad.title}</h4>
                        <p style="color:var(--neon)">${ad.price} AZN</p>
                        <button class="btn" onclick="window.open('https://wa.me/${ad.sellerPhone}')">ALMAQ</button>
                    </div>
                </div>`;
        });
    }

    // ADMIN SİSTEMİ
    function adminTrigger() {
        adminClicks++;
        if(adminClicks === 5) {
            const p = prompt("Kod:");
            if(p === 'qaqa!!02""02') {
                document.getElementById('adminPanel').style.display = 'block';
            }
            adminClicks = 0;
        }
    }

    async function renderAdminUsers() {
        const res = await db.collection("users").get();
        let html = `<table class="admin-table"><tr><th>ID</th><th>Ad</th><th>Əməliyyat</th></tr>`;
        res.forEach(doc => {
            const u = doc.data();
            html += `<tr><td>${u.id}</td><td>${u.name}</td>
                     <td><button onclick="ban('${u.id}')">Ban/Unban</button></td></tr>`;
        });
        document.getElementById('adminContent').innerHTML = html + "</table>";
    }

    async function ban(id) {
        const u = (await db.collection("users").doc(id).get()).data();
        const newStatus = u.status === 'Active' ? 'Banned' : 'Active';
        await db.collection("users").doc(id).update({ status: newStatus });
        alert("Status dəyişdi!");
        renderAdminUsers();
    }

    function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
    loadAds();
</script>
</body>
</html>